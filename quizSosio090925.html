<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Quiz PH Sosiologi</title>
  <style>
    body{margin:0;font-family:sans-serif;background:#0f1724;color:#e6eef6;display:flex;align-items:center;justify-content:center;height:100vh}
    .screen{display:none;width:100%;max-width:960px;padding:20px}
    .active{display:block}
    .card{background:rgba(255,255,255,0.05);padding:20px;border-radius:12px;box-shadow:0 8px 30px rgba(0,0,0,0.5)}
    h1,h2{margin:0 0 16px 0}
    button{padding:10px 16px;border:none;border-radius:8px;background:#6ee7b7;color:#042028;font-weight:600;cursor:pointer;margin:4px}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.2);color:#e6eef6}
    .choice{padding:10px;border-radius:8px;background:rgba(255,255,255,0.05);margin:6px 0;cursor:pointer;transition:all .3s ease}
    .choice:hover{background:rgba(255,255,255,0.1)}
    .choice.correct{background:#16a34a!important;animation:pulse .5s ease}
    .choice.wrong{background:#dc2626!important;animation:shake .3s ease}
    .toolbar{margin-top:20px;display:flex;justify-content:space-between;align-items:center}
    .scoreboard{font-weight:700}
    pre{white-space:pre-wrap;word-break:break-word;background:#0b1220;padding:12px;border-radius:8px;max-height:300px;overflow:auto}
    @keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-5px)}75%{transform:translateX(5px)}}
    @keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.05)}100%{transform:scale(1)}}
    .fade-in{animation:fade .4s ease}
    @keyframes fade{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:none}}
  </style>
</head>
<body>
  <!-- Main Menu -->
  <div id="menu" class="screen active">
    <div class="card">
      <h1>Quiz PH Sosiologi 09-09-25</h1>
      <button onclick="gotoScreen('quiz')">Mulai Quiz</button>
      <button onclick="gotoScreen('viewer')">Lihat Soal</button>
      <button onclick="gotoScreen('editor')">Impor/Ekspor JSON</button>
    </div>
  </div>

  <!-- Quiz Screen -->
  <div id="quiz" class="screen">
    <div class="card fade-in">
      <h2 id="qtext">-</h2>
      <div id="choices"></div>
      <div class="toolbar">
        <span id="progress">0/0</span>
        <span class="scoreboard">Skor: <span id="score">0</span></span>
        <span id="timer">0s</span>
      </div>
      <div style="text-align:right;margin-top:10px">
        <button class="ghost" onclick="gotoScreen('menu')">Menu</button>
      </div>
    </div>
  </div>

  <!-- Viewer Screen -->
  <div id="viewer" class="screen">
    <div class="card">
      <h2>Daftar Soal</h2>
      <div id="questionList"></div>
      <div class="toolbar">
        <button onclick="gotoScreen('menu')">Kembali</button>
      </div>
    </div>
  </div>

  <!-- Editor Screen -->
  <div id="editor" class="screen">
    <div class="card">
      <h2>Editor JSON</h2>
      <textarea id="jsonArea" style="width:100%;height:200px;background:#0f1724;color:#e6eef6;border:1px solid #333;border-radius:8px;padding:8px"></textarea>
      <div class="toolbar">
        <button onclick="saveJSON()">Simpan</button>
        <button onclick="downloadJSON()">Ekspor</button>
        <input type="file" id="fileInput" />
        <button onclick="loadFile()">Impor</button>
        <button onclick="gotoScreen('menu')">Kembali</button>
      </div>
    </div>
  </div>

<script>
  let QUESTIONS = [
  { "q": "Revolusi Prancis berlangsung pada tahun...", "choices": ["1776–1783", "1789–1799", "1804–1815", "1815–1830"], "answer": 1 },
  { "q": "Penyebab utama Revolusi Prancis adalah...", "choices": ["Pajak hanya ditanggung rakyat", "Kemenangan perang", "Kekayaan negara berlebih", "Perkembangan teknologi"], "answer": 0 },
  { "q": "Siapa raja Prancis yang digulingkan pada Revolusi Prancis?", "choices": ["Louis XIV", "Louis XV", "Louis XVI", "Napoleon"], "answer": 2 },
  { "q": "Dokumen penting yang lahir pada Revolusi Prancis adalah...", "choices": ["Magna Charta", "Bill of Rights", "Deklarasi Hak Asasi Manusia dan Warga Negara", "Piagam Madinah"], "answer": 2 },
  { "q": "Revolusi Prancis berakhir dengan kudeta oleh...", "choices": ["Robespierre", "Napoleon Bonaparte", "Raja Louis XVI", "Karl Marx"], "answer": 1 },
  { "q": "Salah satu dampak Revolusi Prancis adalah lahirnya gagasan modern tentang...", "choices": ["Feodalisme", "Monarki absolut", "Demokrasi", "Kapitalisme"], "answer": 2 },
  { "q": "Periode pemerintahan yang penuh eksekusi pada Revolusi Prancis disebut...", "choices": ["Pemerintahan Damai", "Pemerintahan Teror", "Pemerintahan Liberal", "Pemerintahan Nasional"], "answer": 1 },
  { "q": "Revolusi Industri pertama kali terjadi di negara...", "choices": ["Prancis", "Jerman", "Inggris", "Amerika Serikat"], "answer": 2 },
  { "q": "Tokoh yang menyempurnakan mesin uap adalah...", "choices": ["Isaac Newton", "James Watt", "Robert Owen", "Thomas Edison"], "answer": 1 },
  { "q": "Mesin tekstil spinning mule dan power loom berperan dalam...", "choices": ["Industri baja", "Industri tekstil", "Industri transportasi", "Industri makanan"], "answer": 1 },
  { "q": "Urbanisasi besar-besaran pada Revolusi Industri terjadi karena...", "choices": ["Bencana alam", "Perang dunia", "Penduduk desa pindah ke kota untuk bekerja", "Krisis politik"], "answer": 2 },
  { "q": "Proses Bessemer digunakan untuk produksi...", "choices": ["Baja", "Kain", "Kertas", "Uap"], "answer": 0 },
  { "q": "Negara yang kemudian melampaui Inggris dalam industri pada abad ke-20 adalah...", "choices": ["Italia", "Amerika Serikat", "Spanyol", "Belanda"], "answer": 1 },
  { "q": "Auguste Comte dikenal sebagai...", "choices": ["Bapak Kapitalisme", "Bapak Sosiologi", "Bapak Demokrasi", "Bapak Psikologi"], "answer": 1 },
  { "q": "Teori positivisme dikembangkan oleh...", "choices": ["Karl Marx", "Émile Durkheim", "Auguste Comte", "Max Weber"], "answer": 2 },
  { "q": "Tahap perkembangan masyarakat menurut Comte yang menjelaskan dengan agama adalah...", "choices": ["Metafisik", "Positif", "Teologis", "Materialis"], "answer": 2 },
  { "q": "Tahap positif menurut Comte menjelaskan fenomena sosial berdasarkan...", "choices": ["Mitos", "Abstraksi", "Ilmu pengetahuan", "Filsafat moral"], "answer": 2 },
  { "q": "Karl Marx menekankan konflik antara...", "choices": ["Bangsawan dan raja", "Borjuis dan proletar", "Guru dan murid", "Pemerintah dan rakyat"], "answer": 1 },
  { "q": "Konsep alienasi menurut Marx berarti...", "choices": ["Pekerja menikmati hasil kerjanya", "Pekerja terasing dari hasil kerjanya", "Pekerja bebas dari kapitalisme", "Pekerja menjadi pemilik modal"], "answer": 1 },
  { "q": "Menurut Marx, dasar dari suprastruktur adalah...", "choices": ["Politik", "Ekonomi", "Budaya", "Agama"], "answer": 1 },
  { "q": "Durkheim menyebut pola, aturan, norma sebagai...", "choices": ["Nilai moral", "Fakta sosial", "Konflik sosial", "Solidaritas"], "answer": 1 },
  { "q": "Solidaritas mekanis terjadi di masyarakat...", "choices": ["Modern", "Tradisional", "Kapitalis", "Industri"], "answer": 1 },
  { "q": "Solidaritas organis terjadi di masyarakat...", "choices": ["Agraris", "Tradisional", "Modern", "Feodal"], "answer": 2 },
  { "q": "Durkheim meneliti fenomena sosial berupa...", "choices": ["Urbanisasi", "Bunuh diri", "Revolusi", "Alienasi"], "answer": 1 },
  { "q": "Contoh fenomena sosial menurut Comte adalah...", "choices": ["Alienasi", "Urbanisasi", "Solidaritas", "Demokrasi"], "answer": 1 },
  { "q": "Contoh fenomena sosial menurut Marx adalah...", "choices": ["Kesenjangan sosial-ekonomi", "Solidaritas mekanis", "Positivisme", "Metafisik"], "answer": 0 },
  { "q": "Contoh fenomena sosial menurut Durkheim adalah...", "choices": ["Kriminalitas", "Alienasi", "Urbanisasi", "Kapitalisme"], "answer": 0 },
  { "q": "Siapa yang dieksekusi pada masa Pemerintahan Teror?", "choices": ["Robespierre", "Louis XVI", "Marie Antoinette", "Semua benar"], "answer": 3 },
  { "q": "Revolusi Industri didukung oleh Revolusi...", "choices": ["Amerika", "Pertanian", "Prancis", "Teknologi informasi"], "answer": 1 },
  { "q": "Transportasi yang berkembang pesat pada Revolusi Industri adalah...", "choices": ["Mobil", "Pesawat", "Kapal uap dan kereta api", "Sepeda motor"], "answer": 2 },
  { "q": "Lahirnya nasionalisme di Eropa dipengaruhi oleh...", "choices": ["Revolusi Industri", "Revolusi Prancis", "Perang Salib", "Revolusi Amerika"], "answer": 1 },
  { "q": "Salah satu kelemahan Raja Louis XVI adalah...", "choices": ["Lemah dalam kepemimpinan", "Suka berperang", "Tidak punya anak", "Pro-demokrasi"], "answer": 0 },
  { "q": "Kelas borjuis menurut Marx adalah...", "choices": ["Pemilik modal", "Kaum pekerja", "Petani kecil", "Kaum bangsawan"], "answer": 0 },
  { "q": "Kaum proletar menurut Marx adalah...", "choices": ["Pemilik modal", "Buruh pekerja", "Pedagang", "Raja"], "answer": 1 },
  { "q": "Siapa yang memprediksi revolusi proletar?", "choices": ["Auguste Comte", "Karl Marx", "Émile Durkheim", "Napoleon"], "answer": 1 },
  { "q": "Menurut Durkheim, kriminalitas adalah...", "choices": ["Kesalahan individu", "Fakta sosial", "Hasil kapitalisme", "Konflik kelas"], "answer": 1 },
  { "q": "Sosiologi sebagai ilmu pertama kali dicetuskan oleh...", "choices": ["Émile Durkheim", "Auguste Comte", "Karl Marx", "Max Weber"], "answer": 1 },
  { "q": "Positivisme menekankan bahwa sosiologi dipelajari dengan...", "choices": ["Mitos", "Metode ilmiah", "Tradisi", "Filsafat moral"], "answer": 1 },
  { "q": "Revolusi Prancis dimulai ketika rakyat membentuk...", "choices": ["Majelis Nasional", "Partai Buruh", "Uni Eropa", "Majelis Konstituante"], "answer": 0 },
  { "q": "Ratu Prancis yang dieksekusi saat Revolusi adalah...", "choices": ["Victoria", "Catherine", "Marie Antoinette", "Isabella"], "answer": 2 },
  { "q": "Napoleon menyebarkan ide revolusi ke seluruh...", "choices": ["Asia", "Eropa", "Afrika", "Amerika"], "answer": 1 },
  { "q": "Urbanisasi pada Revolusi Industri menyebabkan...", "choices": ["Pertanian maju", "Kota tumbuh modern", "Pajak berkurang", "Feodalisme kuat"], "answer": 1 },
  { "q": "Kondisi kerja pada Revolusi Industri umumnya...", "choices": ["Ringan", "Nyaman", "Berbahaya", "Sangat singkat"], "answer": 2 },
  { "q": "Konsep basis dan suprastruktur dikemukakan oleh...", "choices": ["Durkheim", "Marx", "Comte", "Napoleon"], "answer": 1 },
  { "q": "Solidaritas sosial adalah teori yang dikembangkan oleh...", "choices": ["Marx", "Comte", "Durkheim", "Weber"], "answer": 2 },
  { "q": "Revolusi Industri membawa dampak global berupa...", "choices": ["Kembali ke feodalisme", "Masyarakat industri modern", "Kemunduran teknologi", "Hilangnya urbanisasi"], "answer": 1 },
  { "q": "Revolusi Prancis memberi inspirasi lahirnya konsep...", "choices": ["Demokrasi modern", "Kapitalisme murni", "Feodalisme", "Militerisme"], "answer": 0 },
  { "q": "Durkheim menekankan bahwa faktor sosial dapat memengaruhi...", "choices": ["Psikologi individu", "Ilmu alam", "Perang", "Ekonomi global"], "answer": 0 },
  { "q": "Siapa yang dikenal sebagai Bapak Sosiologi?", "choices": ["Karl Marx", "Émile Durkheim", "Auguste Comte", "Max Weber"], "answer": 2 }
];
  let QUESTIONS_ORIGINAL = []; // salinan untuk referensi
  let idx=0, score=0, timer=null, remaining=0;
  let wrongQuestions = []; 
  let secondRound = false;

  const basePoint=500, bonusPerSecond=20, defaultTime=15;

  function gotoScreen(id){
    document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    if(id==='quiz'){
      QUESTIONS_ORIGINAL = JSON.parse(JSON.stringify(QUESTIONS));
      idx=0; score=0; secondRound=false; wrongQuestions=[];
      document.getElementById('score').textContent=0;
      renderQuestion();
    }
    if(id==='viewer') renderViewer();
    if(id==='editor') document.getElementById('jsonArea').value=JSON.stringify(QUESTIONS,null,2);
  }

  function shuffleArray(arr){
    let a=[...arr];
    for(let i=a.length-1;i>0;i--){
      const j=Math.floor(Math.random()*(i+1));
      [a[i],a[j]]=[a[j],a[i]];
    }
    return a;
  }

  function renderQuestion(){
    if(idx>=QUESTIONS.length){
      if(!secondRound && wrongQuestions.length>0){
        // masuk ronde kedua
        secondRound = true;
        QUESTIONS = wrongQuestions.map(i=>QUESTIONS_ORIGINAL[i]);
        idx=0;
        wrongQuestions=[];
        renderQuestion();
        return;
      } else {
        document.getElementById('qtext').textContent = `Selesai! Skor akhir: ${score}`;
        document.getElementById('choices').innerHTML='';
        document.getElementById('progress').textContent = `Selesai`;
        document.getElementById('timer').textContent='-';
        return;
      }
    }

    const q = JSON.parse(JSON.stringify(QUESTIONS[idx]));
    const correctText = q.choices[q.answer];
    q.choices = shuffleArray(q.choices);
    q.answer = q.choices.indexOf(correctText);

    document.getElementById('qtext').textContent=q.q;
    const wrap=document.getElementById('choices');
    wrap.innerHTML='';
    q.choices.forEach((c,i)=>{
      const div=document.createElement('div');
      div.className='choice fade-in';
      div.textContent=`${String.fromCharCode(65+i)}. ${c}`;
      div.onclick=()=>{selectAnswer(i,q);};
      wrap.appendChild(div);
    });
    document.getElementById('progress').textContent=`${idx+1}/${QUESTIONS.length}`;
    startTimer(defaultTime);
  }

  function startTimer(sec){
    clearInterval(timer);
    remaining=sec;
    document.getElementById('timer').textContent=remaining+"s";
    timer=setInterval(()=>{
      remaining--;
      if(remaining<=0){
        clearInterval(timer);
        remaining=0;
        lockAnswers();
        setTimeout(nextQuestion,1000);
      } 
      document.getElementById('timer').textContent=remaining+"s";
    },1000);
  }

  function selectAnswer(choiceIdx,q){
    clearInterval(timer);
    const nodes=Array.from(document.getElementById('choices').children);
    nodes.forEach((n,i)=>{
      if(i===q.answer) n.classList.add('correct');
      if(i===choiceIdx && choiceIdx!==q.answer) n.classList.add('wrong');
    });
    if(choiceIdx===q.answer){
      score+=basePoint+(remaining*bonusPerSecond);
      document.getElementById('score').textContent=score;
    } else {
      if(!secondRound){ // hanya catat salah di ronde pertama
        wrongQuestions.push(idx);
      }
    }
    setTimeout(nextQuestion,1200);
  }

  function lockAnswers(){
    const wrap=document.getElementById('choices');
    const nodes=Array.from(wrap.children);
    if(nodes.length){
      nodes.forEach((n,i)=>{
        if(i===QUESTIONS[idx].answer) n.classList.add('correct');
      });
    }
  }

  function nextQuestion(){idx++;renderQuestion();}

  function renderViewer(){
    const list=document.getElementById('questionList');
    list.innerHTML='';
    QUESTIONS_ORIGINAL.forEach((q,i)=>{
      const d=document.createElement('div');
      d.style.marginBottom='12px';
      d.innerHTML=`<strong>${i+1}. ${q.q}</strong><br> Pilihan: ${q.choices.join(', ')}`;
      list.appendChild(d);
    });
  }

  function saveJSON(){
    try{
      QUESTIONS=JSON.parse(document.getElementById('jsonArea').value);
      alert('Disimpan!');
    }
    catch(e){alert('Format JSON salah');}
  }

  function downloadJSON(){
    const blob=new Blob([JSON.stringify(QUESTIONS_ORIGINAL,null,2)],{type:'application/json'});
    const a=document.createElement('a');
    a.href=URL.createObjectURL(blob);
    a.download='quiz.json';
    a.click();
  }

  function loadFile(){
    const f=document.getElementById('fileInput').files[0];
    if(!f) return;
    const r=new FileReader();
    r.onload=e=>{
      try{
        QUESTIONS=JSON.parse(e.target.result);
        QUESTIONS_ORIGINAL=JSON.parse(JSON.stringify(QUESTIONS));
        alert('Impor berhasil');
      }catch{
        alert('Format salah');
      }
    };
    r.readAsText(f);
  }
</script>

</body>
</html>
